---
title: 'Release notes for EDB Postgres for Kubernetes 1.18'
originalFilePath: 'src/release_notes/old/v1.18.md'
---

History of user-visible changes in the 1.18 minor release of EDB Postgres for Kubernetes.

For a complete list of changes, please refer to the
[commits](https://github.com/EnterpriseDB/cloud-native-postgres/commits/release-1.18)
on the release branch in GitHub.

## Version 1.18.13

**Release date:** Jun 13, 2024

!!! Warning
    This is expected to be the last release in the 1.18.X series.
    Users are encouraged to update to a newer minor version soon.

### Enhancements:

-   Enabled the configuration of the liveness probe timeout via the
    `.spec.livenessProbeTimeout` option (#4719)

### Fixes:

-   Prevented fenced instances from entering an unnecessary loop and consuming
    all available CPU (#4625)

-   Resolved an issue where the instance manager on the primary would
    indefinitely wait for the instance to start after encountering a failure
    following a stop operation (#4434)

-   Fixed a panic in the backup controller that occurred when pod container
    statuses were missing (#4765)

-   Prevented unnecessary shutdown of the instance manager (#4670)

-   Prevented unnecessary reloads of PostgreSQL configuration when unchanged (#4531)

-   Prevented unnecessary reloads of the ident map by ensuring a consistent and
    unique method of writing its content (#4648)

-   Avoided conflicts during phase registration by patching the status of the
    resource instead of updating it (#4637)

-   Implemented a timeout when restarting PostgreSQL and lifting fencing (#4504)

-   Ensured that a replica cluster is restarted after promotion to properly set
    the archive mode (#4399)

-   Ensured correct parsing of the additional rows field returned when the
    `pgaudit.log_rows` option was enabled, preventing audit logs from being
    incorrectly routed to the normal log stream (#4394)

### Changes

-   Default operand image set to PostgreSQL 16.3 (#4584)
-   Removed all RBAC requirements on namespace objects (#4753)

## Version 1.18.12

**Release date:** Apr 18, 2024

### Enhancements

– Upgrade process from 1.18.x LTS to 1.22.x LTS (#702,#683,#676)
– Documentation for Kubernetes 1.29.x or above (#3729)

-   Cleanup of instance Pods not owned by the Cluster during Cluster restore
    (#4141)

### Fixes

-   Ensured that before a switchover, the elected replica is in streaming
    replication (#4288)
-   Correctly handle parsing errors of instances' LSN when sorting them (#4283)
-   Recreate the primary Pod if there are no healthy standbys available to
      promote (#4132)
    – Allow backup hooks to be called while using Velero backup (#655)
    – Wait for the Restic init container to be completed (#670)

### Security

– Update all Go dependencies to fix any latest security issue (#700)

## Version 1.18.11

**Release date:** Mar 22, 2024

### Enhancements

-   Allow customization of the `wal_level` GUC in PostgreSQL (#4020)
-   Add the `cnpg.io/skipWalArchiving` annotation to disable WAL archiving when
    set to `enabled` (#4055)
-   Enrich the `cnpg` plugin for `kubectl` with the `publication` and
    `subscription` command groups to imperatively set up PostgreSQL native
    logical replication (#4052)
-   Allow customization of `CERTIFICATE_DURATION` and `EXPIRING_CHECK_THRESHOLD`
    for automated management of TLS certificates handled by the operator (#3686)
-   Retrieve the correct architecture's binary from the corresponding catalog in
    the running operator image during in-place updates, enabling the operator to
    inject the correct binary into any Pod with a supported architecture (#3840)

### Fixes

-   Properly synchronize PVC group labels with those on the pods, a critical
    aspect when all pods are deleted and the operator needs to decide which Pod
    to recreate first (#3930)
-   Disable `wal_sender_timeout` when cloning a replica to prevent timeout errors
    due to slow connections (#4080)
-   Ensure backup are ready before initiating recovery bootstrap
    procedures, preventing an error condition where recovery with incomplete
    backups could enter an error loop (#3663)
-   Resolve a corner case in hibernation where the instance pod has been deleted,
    but the cluster status still has the hibernation condition set to false (#3970)
-   Correctly detect Google Cloud capabilities for Barman Cloud (#3931)

### Security

-   Use `Role` instead of `ClusterRole` for operator permissions in OLM,
    requiring fewer privileges when installed on a per-namespace basis (#3855,
    \#3990)
-   Enforce fully-qualified object names in SQL queries for the PgBouncer pooler
    (#4080)

### Changes

-   Set the default operand image to PostgreSQL 16.2 (#3823).

## Version 1.18.10

**Release date:** Feb 2, 2024

Enhancements:

-   Tailor ephemeral volume storage in a Postgres cluster using a claim template
    through the `ephemeralVolumeSource` option (#3678)
-   Introduce the `pgadmin4` command in the `cnp` plugin for `kubectl`,
    providing a straightforward method to demonstrate connecting to a given
    database cluster and navigate its content in a local environment such as kind -
    for evaluation purposes only (#3701)
-   Allow customization of PostgreSQL's ident map file via the
    `.spec.postgresql.pg_ident` stanza, through a list of user name maps (#3534)

Fixes:

-   Prevent an unrecoverable issue with `pg_rewind` failing due to
    `postgresql.auto.conf` being read-only on clusters where the `ALTER SYSTEM`
    SQL command is disabled - the default (#3728)
-   Reduce the risk of disk space shortage when using the import facility of the
    `initdb` bootstrap method, by disabling the durability settings in the PostgreSQL
    instance for the duration of the import process (#3743)
-   Avoid pod restart due to erroneous resource quantity comparisons, e.g. "1 !=
    1000m"  (#3706)
-   Properly escape reserved characters in `pgpass` connection fields (#3713)
-   Prevent systematic rollout of pods due to considering zero and nil different
    values in `.spec.projectedVolumeTemplate.sources` (#3647)
-   Ensure configuration coherence by pruning from `postgresql.auto.conf` any
    options now incorporated into `override.conf` (#3773)

## Version 1.18.9

**Release date:** Dec 22, 2023

### Security

-   By default, TLSv1.3 is now enforced on all PostgreSQL 12 or higher
    installations. Additionally, users can configure the `ssl_ciphers`,
    `ssl_min_protocol_version`, and `ssl_max_protocol_version` GUCs (#3408).
-   Integration of Docker image scanning with Dockle to enhance security
    measures.

### Enhancements

-   Improved reconciliation of external clusters (#3533).
-   Introduction of the ability to enable/disable the `ALTER SYSTEM` command (#3535).
-   Support for Prometheus' dynamic relabeling through the
    `podMonitorMetricRelabelings` and `podMonitorRelabelings` options in the
    `.spec.monitoring` stanza of the `Cluster` and `Pooler` resources (#3075).
-   Elimination of the use of the `PGPASSFILE` environment variable when
    establishing a network connection to PostgreSQL (#3522).
-   Improved `cnp report` plugin command by collecting a cluster's PVCs (#3357).
-   Connection pooler:
    -   Scaling down instances of a `Pooler` resource to 0 is now possible (#3517).
    -   Addition of the `k8s.enterprisedb.io/podRole` label with a value of 'pooler' to every
        pooler deployment, differentiating them from instance pods (#3396).

### Fixes

-   Reconciliation of metadata, annotations, and labels of `PodDisruptionBudget`
    resources (#3312 and #3434).
-   Reconciliation of the metadata of the managed credential secrets (#3316).
-   Disabling of wal_sender_timeout when joining through pg_basebackup (#3586)
-   Reloading of secrets used by external clusters (#3565)
-   Connection pooler:
    -   Ensuring the controller watches all secrets owned by a `Pooler` resource (#3428).
    -   Reconciliation of `RoleBinding` for `Pooler` resources (#3391).
    -   Reconciliation of `imagePullSecret` for `Pooler` resources (#3389).
    -   Reconciliation of the service of a `Pooler` and addition of the required labels (#3349).
    -   Extension of `Pooler` labels to the deployment as well, not just the pods (#3350).

### Changes

-   Default operand image set to PostgreSQL 16.1 (#3270).

## Version 1.18.8

**Release date:** Nov 8, 2023

Enhancements:

-   Enhance the `status` command of the `cnp` plugin for `kubectl` with progress
    information on active streaming base backups (#3101)
-   Allow the configuration of `max_prepared_statements` with the pgBouncer
    `Pooler` resource (#3174)

Fixes:

-   Suspend WAL archiving during a switchover and resume it when it is completed
    (#3227)
-   Ensure that the instance manager always uses `synchronous_commit = local`
    when managing the PostgreSQL cluster (#3143)
-   Custom certificates for streaming replication user through
    `.spec.certificates.replicationTLSSecret` are now working (#3209)
-   Set the `k8s.enterprisedb.io/cluster` label to the `Pooler` pods (#3153)

Changes:

-   Stop using the `postgresql.auto.conf` file inside PGDATA to control Postgres
    replication settings, and replace it with a file named `override.conf` (#2812)

Technical enhancements:

-   Use extended query protocol for PostgreSQL in the instance manager (#3152)

## Version 1.18.7

**Release date:** Oct 18, 2023

Important Changes:

-   Change the default value of `stopDelay` to 1800 seconds instead of 30 seconds
    (#2848)
-   Introduce a new parameter, called `smartShutdownTimeout`, to control the
    window of time reserved for the smart shutdown of Postgres to complete; the
    general formula to compute the overall timeout to stop Postgres is
    `max(stopDelay -  smartShutdownTimeout, 30)` (#2848)
-   Change the default value of `startDelay` to 3600, instead of 30 seconds
    (#2847)
-   Replace the livenessProbe initial delay with a more proper Kubernetes
    startup probe to deal with the start of a Postgres server (#2847)
-   Change the default value of `switchoverDelay` to 3600 seconds instead of
    40000000 seconds (#2846)

Security:

-   Add a default `seccompProfile` to the operator deployment (#2926)

Enhancements:

-   Introduce the `k8s.enterprisedb.io/coredumpFilter` annotation to control the content of a
    core dump generated in the unlikely event of a PostgreSQL crash, by default
    set to exclude shared memory segments from the dump (#2733)
-   Allow to configure ephemeral-storage limits for the shared memory and
    temporary data ephemeral volumes (#2830)
-   Validate resource limits and requests through the webhook (#2663)
-   Ensure that PostgreSQL's `shared_buffers` are coherent with the pods'
    allocated memory resources (#2840)
-   Add `uri` and `jdbc-uri` fields in the credential secrets to facilitate
    developers when connecting their applications to the database (#2186)
-   Add a new phase `Waiting for the instances to become active` for finer
    control of a cluster's state waiting for the replicas to be ready (#2612)
-   Improve detection of Pod rollout conditions through the `podSpec` annotation
    (#2243)
-   Add primary timestamp and uptime to the kubectl plugin's `status` command
    (#2953)

Fixes:

-   Ensure that the primary instance is always recreated first by prioritizing
    ready PVCs with a primary role (#2544)
-   Honor the `k8s.enterprisedb.io/skipEmptyWalArchiveCheck` annotation during recovery to
    bypass the check for an empty WAL archive (#2731)
-   Prevent a cluster from being stuck when the PostgreSQL server is down but the
    pod is up on the primary (#2966)
-   Avoid treating the designated primary in a replica cluster as a regular HA
    replica when replication slots are enabled (#2960)
-   Reconcile services every time the selectors change or when labels/annotations
    need to be changed (#2918)
-   Defaults to `app` both the owner and database during recovery bootstrap
    (#2957)
-   Avoid write-read concurrency on cached cluster (#2884)
-   Remove empty items, make them unique and sort in the `ResourceName` sections
    of the generated roles (#2875)
-   Ensure that the `ContinuousArchiving` condition is properly set to 'failed'
    in case of errors (#2625)
-   Reconcile PodMonitor `labels` and `annotations` (#2583)
-   Fix backup failure due to missing RBAC `resourceNames` on the `Role` object
    (#2956)
-   Observability:

    -   Add TCP port label to default `pg_stat_replication` metric (#2961)
    -   Fix the `pg_wal_stat` default metric for Prometheus (#2569)
    -   Improve the `pg_replication` default metric for Prometheus (#2744 and
        \#2750)
    -   Use `alertInstanceLabelFilter` instead of `alertName` in the provided
        Grafana dashboard
    -   Enforce `standard_conforming_strings` in metric collection (#2888)

Changes:

-   Set the default operand image to PostgreSQL 16.0
-   Fencing now uses PostgreSQL's fast shutdown instead of smart shutdown to halt
    an instance (#3051)
-   Rename webhooks from kb.io to k8s.enterprisedb.io group (#2851)
-   Add the `k8s.enterprisedb.io/instanceRole` label while deprecating the existing `role`
    label (#2915)

Technical enhancements:

-   Replace `k8s-api-docgen` with `gen-crd-api-reference-docs` to automatically
    build the API reference documentation (#2606)

## Version 1.18.6

**Release date:** July 27, 2023

Enhancements:

-   Add a metric and status field to monitor node usage by a CloudNativePG cluster (#2257)
-   Various enhancements to the documentation:
    -   Add troubleshooting instructions relating to hugepages (#1390)
    -   Extend the FAQs page (#2344)

Technical enhancements:

-   Add a check at the start of the restore process to ensure it can proceed; give
    improved error diagnostics if it cannot (#2419)

Fixes:

-   Ensure the logic of setting the recovery target matches that of Postgres (#2460)
-   Prevent taking over service accounts not owned by the cluster, by setting
    ownerMetadata only during service account creation (#2462)
-   Prevent a possible crash of the instance manager during the configuration reload (#2393)
-   Prevent the LastFailedArchiveTime alert from triggering if a new backup has been
    successful after the failed ones (#1751)

Security:

-   Updated all project dependencies to the latest versions

## Version 1.18.5

**Release date:** June 12, 2023

!!! Warning
    This is expected to be the last release in the 1.18.X series. 
    Users are encouraged to update to a newer minor version soon.

Enhancements:

-   Add the `snapshot` command to the `cnp` plugin to create a consistent cold
    backup of the cluster from a standby using the Kubernetes `VolumeSnapshot`
    standard resource (#1960)
-   First implementation of recovery from a set of CSI VolumeSnapshot resources
    via the `.spec.bootstrap.recovery.volumeSnapshot` stanza (#1960)
-   Add `pg_failover_slots` to managed extensions (#2057)
-   Improved Grafana dashboard with updated instructions in the documentation and
    the quickstart guide (#1916)
-   Introduce the `schemaOnly` option in the `import` stanza, to avoid exporting
    and importing data when you bootstrap a new Postgres Cluster from one or more
    existing databases (#2234)
-   Add support for TopologySpreadConstraints to manage scheduling of instance
    pods (#2202)
-   Add `PodMonitor` support to the `Pooler`for PgBouncer (#2034)
-   Add option to override the default Kubernetes scheduler (#2013)
-   Allow configuration of deployment strategy of a `Pooler` resource (#1983)
-   Update default PostgreSQL version to 15.3 (#2022)
-   Use PgBouncer 1.19 by default (#2018)

Technical enhancements:

-   Updated k8s kind tested versions (#2054)
-   Use separate transactions to reconcile role credentials. Before this patch,
    the operator would revert the synchronization of all roles if one failed
    (#2004)
-   Ensure fencing is removed during cluster restore (#1987)
-   Improve logging when deleting Pods (#2136)

Fixes:

-   Fix unbound variable with k3s engine which could prevent setup on K3’s (#2157)
-   Report the correct PG version in the metrics (#2126)
-   Use the correct walStorage key in the documentation (#2140)
-   Halt reconciliation when the operator cannot connect with the instances, and
    provide a clear diagnostic on such occasions. This will help clarify cases
    where network issues obstruct normal operation of EDB Postgres for Kubernetes (#2145),
    (#2233), and (#2242)

## Version 1.18.4

**Release date:** April 27, 2023

!!! Important
    EDB Postgres for Kubernetes is dropping support for PostgreSQL 10, as PostgreSQL 10
    reached End-of-Life (EOL) in November 2022. Versions 11 and newer are
    supported. Please plan your migration to PostgreSQL 15 as soon as possible.
    Refer to ["Importing Postgres databases"](https://cloudnative-pg.io/documentation/current/database_import/)
    for more information on PostgreSQL major offline upgrades.

Enhancements:

-   Improve the `--logs` option of the `report` command of the `cnp` plugin for
    `kubectl` to also include the previous logs where available (#1811)
-   The `-any` service is now disabled by default (#1755)

Security:

-   Enable customization of `SeccompProfile` through override via a local file (#1827)

Fixes:

-   Apply the PostgreSQL configuration provided by the user during the `initdb`
    bootstrap phase, before the server is started the first time (#1858)

## Version 1.18.3

**Release date:** March 20, 2023

Enhancements:

-   Extend the `debug` cluster's log level to the `initdb` job (#1503)
-   Support IPv6 and custom `pg_hba` for the PgBouncer pooler (#1395)
-   Enhance observability of backups with two new metrics and additional
    information in the status (#1428)
-   Document API calls from the instance manager (#1641)
-   Clarify deployment name via Helm (#1505)
-   Add the `psql` command to the `cnp` plugin for `kubectl` (#1668) allowing
    the user to start a `psql` session with a pod (the primary by default)

Technical enhancements:

-   Adopt Renovate for dependency tracking/updating (#1367, #1473)
-   Inject binaries for all supported architectures in the operator image (#1513)
-   Use the backup name to match resources in the backup object store (#1650)
    Leverages the `--name` option introduced with Barman 3.3 to make the
    association between backups and the object store more robust.

Fixes:

-   Prevent panic with error handling in the probes (#1716)
-   Ensure that the HTTP package and controller runtime logs are in JSON format (#1442)
-   Adds WAL storage to a cluster in a single instance Cluster (#1570)
-   Various improvements to make backup code more robust (#1536, #1564, #1588, #1466,  #1647)
-   Properly show WAL archiving information with `status` command of the `cnp` plugin (#1666)
-   Ensure `nodeAffinity` is applied even if `AdditionalPodAffinity` and
    `AdditionalPodAntiAffinity` are not set (#1663)

## Version 1.18.2

**Release date:** Feb 14, 2023

Enhancements:

-   Introduce support for Kubernetes' projected volumes (#1269)
-   Introduce support custom environment variables for finer control of the PostgreSQL
    server process (#1275)
-   Introduce the `backup` command in the `cnp` plugin for `kubectl` to
    issue a new base backup of the cluster (#1348)
-   Improve support for the separate WAL volume feature by enabling users to move
    WAL files to a dedicated volume on an existing Postgres cluster (#1066)
-   Enhance WAL observability with additional metrics for the Prometheus
    exporter, including values equivalent to the `min_wal_size`, `max_wal_size`,
    `keep_wal_size`, `wal_keep_segments`, as well as the maximum number of WALs
    that can be stored in the dedicated volume (#1382)
-   Add a database comment on the `streaming_replica` user (#1349)
-   Document the firewall issues with webhooks on GKE (#1364)
-   Add note about postgresql.conf in `recovery` (#1211)
-   Add instructions on installing plugin using packages (#1357)
-   Specify Postgres versions supported by each minor release (#1355)
-   Clarify the meaning of PVC group in EDB Postgres for Kubernetes (#1344)
-   Add an example of the DigitalOcean S3-compatible Spaces (#1289)

Technical enhancements:

-   Added daily end-to-end smoke test for release branches (#1235)

Fixes:

-   Skip executing a `CHECKPOINT` as the `streaming_replica` user (#1408)
-   Make `waitForWalArchiveWorking` resilient to connection errors (#1399)
-   Ensure that the PVC roles are always consistent (#1380)
-   Permit `walStorage` resize when using `pvcTemplate` (#1315)
-   Ensure `ExecCommand` obeys timeout (#1242)
-   Avoid `PodMonitor` reconcile if Prometheus is not installed (#1238)
-   Avoid looking for `PodMonitor` when not needed (#1213)

## Version 1.18.1

**Release date:** Dec 21, 2022

Important announcements:

-   Alert on the impending deprecation of `postgresql` as a label to identify the
    CNP cluster. In the remote case you have used this label, please start using
    the `k8s.enterprisedb.io/cluster` label instead (#1130)
-   Recognizing Armando Ruocco (@armru) as a new EDB Postgres for Kubernetes maintainer for his
    consistent and impactful contributions (#1167)
-   Remove ARMv7 support (#1092)
-   FINAL patch release for 1.16: 1.16.5. Release 1.16 reaches end of life.

Enhancements:

-   Customize labels and annotations for the service account: add a service
    account template that can be used, for example, to make authentication easier
    via identity management on GKE or EKS via IRSA (#1105)
-   Add `nodeAffinity` support (#1182) - allows for richer scheduling options
-   Improve compatibility with Istio: add support for Istio's quit endpoint so
    that jobs with Istio sidecars do not run indefinitely (#967)
-   Allow fields remapping in JSON logs: helpful for use cases where the `level`
    and `ts` fields might interfere with the  existing logging (#843)
-   Add `fio` command to the kubectl-cnp plugin (#1097)
-   Add rpm/deb package for kubectl-cnp plugin (#1008)
-   Update default PostgreSQL version for new cluster definitions to 15.1 (#908)
-   Documentation
    -   Remove references to CNP sandbox (#1120) - the CNP sandbox has been
        deprecated, in favor of instructions on monitoring in the Quickstart
        documentation
    -   Link to the "Release updates" discussion (#1148) - the release updates
        discussion will become the default channel for release announcements and
        discussions
    -   Document emeritus status for maintainers in GOVERNANCE.md (#1033) - explains
        how maintainers should proceed if they are not ready to continue
        contributing
    -   Improve instructions on creating pull requests (#1132)
    -   Troubleshooting emergency backup instructions (#1184)
-   Cover the Kubernetes layer in greater detail in the Architecture
    documentation (#1432)

Fixes:

-   Ensure PGDATA permissions on bootstrap are properly set to 750 (#1164)
-   Ensure the PVC containing WALs is deleted when scaling down the cluster
    (#1135)
-   Fix missing ApiVersion and Kind in the pgbench manifest when using `--dry-run`
    (#1088)
-   Ensure that we create secrets and services only when not found (#1145)
-   Respect configured pg-wal when restoring (#1216)
-   Filter out replicas from nodeToClusters map (#1194)

Technical enhancements:

-   Use `ciclops` for test summary (#1064): rely on the ciclops GitHub action to
    provide summaries of the E2E suite, inheriting improvements from that project
-   Add backport pull request workflow (#965) - automatically backport patches to
    release branches if they are so annotated
-   Make the operator log level configurable in e2e test suite (#1094)
-   Enable test execution based on labels (#951)
-   Update Go version from 1.18 to 1.19 (#1166)

## Version 1.18.0

**Release date:** Nov 10, 2022

Features:

-   **Cluster-managed physical replication slots for High Availability**:
    automatically manages physical replication slots for each hot standby replica
    in the High Availability cluster, both in the primary and the standby (#740)
-   **Postgres cluster hibernation**: introduces cluster hibernation via the plugin,
    with a new subcommand `kubectl cnp hibernate on/off/status <cluster-name>`.
    Hibernation destroys all the resources generated by the cluster, except the
    PVCs that belong to the PostgreSQL primary instance (#782)

Security:

-   Add `SeccomProfile` to Pods and Containers (#888)

Enhancements:

-   Allow omitting the storage size in the cluster spec if there is a size request
    in the `pvcTemplate` (#914)
-   `status` command for the `cnp` plugin:
    -   Add replication slots information (#873)
    -   Clarify display for fenced clusters (#886)
    -   Improve display for replica clusters (#871)
-   Documentation:
    -   Improve monitoring page, providing instructions on how to evaluate the
        observability capabilities of EDB Postgres for Kubernetes on a local system using
        Prometheus and Grafana (#968)
    -   Add page on design reasons for custom controller (#918)
    -   Updates to the End-to-End Test Suite page (#945)
-   New subcommands in the `cnp` plugin:
    -   `pgbench` generates a job definition executing `pgbench` against a cluster
        (#958)
    -   `install` generates an installation manifest for the operator (#944)
-   Set PostgreSQL 15.0 as the new default version (#821)

Fixes:

-   Import a database with `plpgsql` functions (#974)
-   Properly find the closest backup when doing Point-in-time recovery (#949)
-   Clarify that the `ScheduledBackup` format does not follow Kubernetes `CronJob`
    format (#883)
-   Bases the failover logic on the Postgres information from the instance
    manager, rather than Kubernetes pod readiness, which could be stale (#890)
-   Ensure we have a WAL to archive for every newly created cluster. The lack
    could prevent backups from working (#897)
-   Correct YAML key names for `barmanObjectStore` in documentation (#877)
-   Fix `krew` release (#866)
